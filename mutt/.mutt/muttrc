# Tibor's mutt configuration.

# Colour scheme
source ~/.mutt/gruvbox-theme

# Status line
set status_format="Mutt: %f [Msgs:%?M?%M/?%m%?n? New:%n?%?d? Del:%d?%?F? Flag:%F?%?t? Tag:%t?%?p? Post:%p?%?b? Inc:%b? Size:%l]___(%s)_%>_(%P)___"

# Speed
set sleep_time = 0

# Attachments
set mailcap_path = ~/.mutt/mailcap

# Sort preferences
set sort=threads
set sort_browser=reverse-date
set sort_aux=last-date-received

# Address book
set query_command = "echo && notmuch address from:%s"
set query_format="%4c %t %-70.70a %-70.70n %?e?(%e)?"
bind editor <Tab> complete-query
bind editor ^T complete

# HTML mail
auto_view text/html
alternative_order text/plain text/enriched text/html

# CERN
set mbox_type = Maildir
set folder = ~/Local/mbsyncmail
set spoolfile = +INBOX
set header_cache = ~/.cache/mutt
set message_cachedir = ~/.cache/mutt
set postponed = =Drafts
set record = =Archive
save-hook . =Archive

# Wrap lines when viewing mail
set wrap=80
set smart_wrap=yes

# Do not show any leading markers when wrapping lines
set markers=no

# Show mail index when viewing a message
set pager_index_lines=10

# View message headers in wanted order
unhdr_order *
hdr_order From: To: Cc: Subject: Date:

# Composing mail
#my_hdr Bcc: Tibor Simko <tibor.simko@cern.ch>
set attribution = "On %[!%a, %d %b %Y at %H:%M], %n wrote:"
set fast_reply = yes
set include = yes
set edit_headers = yes
set text_flowed = yes
set signature = "~/.mutt/signature"
unset sig_dashes

# Sending mail
set realname = "Tibor Simko"
set from = "tibor.simko@cern.ch"
set sendmail = "/usr/bin/msmtp --account=cern"

# Key bindings - general vim-like
bind pager g top
bind pager G bottom
bind attach,index g first-entry
bind attach,index G last-entry
bind index,pager R group-reply

# Key bindings - quick folder operations
macro index,pager ,,  "<change-folder>=INBOX<enter><limit>~U<enter>" "Shortcut to go to unread INBOX"
macro index,pager ,g1  "<change-folder>=INBOX<enter><limit>~d <1d<enter>" "Go to last 1 day"
macro index,pager ,g7  "<change-folder>=INBOX<enter><limit>~d <1w<enter>" "Go to 7 days"
macro index,pager ,ga "<change-folder>=Archive<enter>" "Go to Archive folder"
macro index,pager ,gg "<change-folder>=Github<enter>" "Go to Github folder"
macro index,pager ,gi "<change-folder>=INBOX<enter>" "Go to INBOX folder"
macro index,pager ,gj "<change-folder>=Junk<enter>" "Go to Junk folder"
macro index,pager ,gu  "<change-folder>=INBOX<enter><limit>~U<enter>" "Go to unread"

# Key bindings - mail archiving
macro index,pager ,a ":set confirmappend=no delete=yes auto_tag=yes\n<save-message>=Archive\n<sync-mailbox>:set confirmappend=yes delete=ask-yes\n"

# Key bindings - muttjump
macro generic ,j "<enter-command>push <pipe-message>muttjump<enter><enter>" "jump to original message"

# Key bindings - taskwarrior
macro index,pager ,T "<pipe-message>/usr/share/taskopen/scripts/mutt2task<enter>"
macro index,pager ,m "<pipe-message>/usr/share/taskopen/scripts/mess2task2<enter>"
macro index,pager ,M "<pipe-message>/usr/share/taskopen/scripts/mess2task<enter>"

# Key bindings - notmuch
macro index ,s \
"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
<shell-escape>notmuch-mutt -r --prompt search<enter>\
<change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter>\
<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
"notmuch: search mail"
macro index ,t \
"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
<pipe-message>notmuch-mutt -r thread<enter>\
<change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter>\
<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
"notmuch: reconstruct thread"

# Key bindings - mbsync
macro index ,x \
"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
<shell-escape>x1-mbsync inbox<enter>\
<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
"Synchronise inbox folders (fast)"
macro index ,X \
"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
<shell-escape>x1-mbsync inbox archive<enter>\
<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
"Synchronise inbox folders and current archive (medium)"
macro index ,Y \
"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
<shell-escape>x1-mbsync all<enter>\
<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
"Synchronise inbox folders and all past archives (slow)"
